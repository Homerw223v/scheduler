
# Сервис billing
## Часть общего проекта. Ссылка на полный проект https://github.com/Homerw223v/Online-Cinema
Сервис предназначен для проведения оплаты услуг предоставляемых онлайн кинотеатром, состоит из следующих компонентов: 
 - Микросервис платежей. Отвечает за проведение и фиксацию операций.
 - Панель администратора. Интерфейс для просмотра и управления тарифами и пользовательскими подписками.
 - Планировщик. Микросервис для периодической рассылки уведомлений и автопролонгации подписок.

Сервис предоставляет информацию об актуальных подписках пользователей смежным сервисам



## Запуск
1. Перед запуском необходимо настроить переменные окружения в файлах `.env` перечень используемых переменных можно найти
в `example.env`. 
2. Создать роль `service` и добавить пользователя с этой ролью в сервисе auth. Учетные данные сервисной учетки 
необходимо укзать в окружении сервисов.
3. Создать шаблон на подтверждение почты в сервисе admin_template. И указать id шаблона в сервисе auth.

Запуск рабочего сервиса:

`docker compose up -d` для частичного запуска сервиса можно указать необходимый профиль в окружении или параметрах 
запуска.

После запуска сервис будет доступен по адресу: `http://127.0.0.1/`

Ссылка на панель администратора: `http://127.0.0.1/billing-admin/admin`

## Документация
Документация на API доступна по ссылке:

`http://127.0.0.1/billing-admin/api/openapi`

`http://127.0.0.1/billing/api/openapi`

## Функционал:

### Платежный сервис

- Создание, возврат и проверка статуса платежей
- Получение списка подписок пользователя
- Управление автопролонгацией подписки
- Управление картами пользователя

### Панель администратора

Создание, просмотр, обновление и удаление записей из следующих таблиц:
- Тарифы
- Подписки
- Подписки пользователей
- История транзакций

### Планировщик

- Автопродление подписок
- Уведомления пользователей о заканчивающейся подписке
- Уведомления пользователей о продлении подписки

## ETL

Актуализация подписок в сервисе контента


## Дополнительная информация

В проекте реализован механизм ограничения количества запросов средствами nginx. Для его корректировки измените значения 
`limit_req_zone` в файле `nginx/nginx.conf`, а также `limit_req` в файле `nginx/configs.conf`.

